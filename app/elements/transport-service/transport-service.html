<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="transport-service">
  <template>
<iron-ajax
        method="post"
        id="getrouteajax"
        url="{{getrouteurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getrouteResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getroutedetailajax"
        url="{{getroutedetailurl}}"
        params="{{getroutedetailparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getroutedetailResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    <iron-ajax
        method="post"
        id="insertpointajax"
        url="{{insertpointurl}}"
        params="{{insertpointparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="insertpointResponse"
        debounce-duration="300"
        >
  </iron-ajax>
      <iron-ajax
        method="post"
        id="routeidajax"
        url="{{routeidurl}}"
        params="{{routeidparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="routeidResponse"
        debounce-duration="300"
        >
  </iron-ajax>

 </iron-ajax>
      <iron-ajax
        method="post"
        id="sequenceajax"
        url="{{sequenceurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="sequenceResponse"
        debounce-duration="300"
        >
  </iron-ajax>

  <iron-ajax
        method="post"
        id="getzoneajax"
        url="{{getzoneurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getzoneResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getfeeajax"
        url="{{getfeeurl}}"
        params="{{getfeeparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getfeeResponse"
        debounce-duration="300"
        >
  </iron-ajax>
 <iron-ajax
        method="post"
        id="setzoneajax"
        url="{{setzoneurl}}"
        params="{{setzoneparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="setzoneResponse"
        debounce-duration="300"
        >
  </iron-ajax>
<iron-ajax
        method="post"
        id="getstdajax"
        url="{{getstdurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getstdResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getsecajax"
        url="{{getsecurl}}"
        params="{{getsecparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getsecResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getnameajax"
        url="{{getnameurl}}"
        params="{{getnameparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getnameResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getstudetailajax"
        url="{{getstudetailurl}}"
        params="{{getstudetailparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="getstudetailResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="getrouteajax"
        url="{{getrouteurl}}"
        handle-as="json"
        content-type="application/json"
        on-response="getrouteResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="genereportajax"
        url="{{genereporturl}}"
        params="{{genereportparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="genereportResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="gettripajax"
        url="{{gettripurl}}"
        params="{{gettripparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="gettripResponse"
        debounce-duration="300"
        >
  </iron-ajax>
     <iron-ajax
        method="post"
        id="gradediscountajax"
        url="{{gradediscounturl}}"
        params="{{gradediscountparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="gradediscountResponse"
        debounce-duration="300"
        >
  </iron-ajax>
     <iron-ajax
        method="post"
        id="addcalcajax"
        url="{{addcalcurl}}"
        params="{{addcalcparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="addcalcResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="cancellationajax"
        url="{{cancellationurl}}"
        params="{{cancellationparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="cancellationResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="cancelajax"
        url="{{cancelurl}}"
        params="{{cancelparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="cancelResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="proceedcancelajax"
        url="{{proceedcancelurl}}"
        params="{{proceedcancelparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="proceedcancelResponse"
        debounce-duration="300"
        >
  </iron-ajax>
   <iron-ajax
        method="post"
        id="transportrequiredstatusajax"
        url="{{transportrequiredstatusurl}}"
        params="{{transportrequiredstatusparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="transportrequiredstatusResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    <iron-ajax
        method="post"
        id="gettermdateajax"
        url="{{gettermdateurl}}"
        params="{{gettermdateparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="gettermdateResponse"
        debounce-duration="300"
        >
  </iron-ajax>
    </template>

  <script>
  (function() {
    var point;
    var trip;
    var pick;
    var drop;
    var routeidd;
    var routetrip="";
    var gradedis="";
    var totalfee;
    var finalfee;
    var calcfee;


    Polymer({
      is: "transport-service",
     
       getroute:function()
      {
        this.getrouteurl="http://localhost:8081/getroute";
        this.$.getrouteajax.generateRequest();
      },
      getrouteResponse:function(e1)
      {
         a2=e1.detail.response.returnval;
        document.querySelector('mappointtoroute-card').routearr=a2;
      },
       getroutedetail:function(tripno)
      {
        //alert('Hi  ...   '+routetrip);
        this.getroutedetailurl="http://localhost:8081/getroutedetail";
        var obj={"routename":"","tripnos":""};
        obj.routename=routetrip;
        obj.tripnos=tripno;
        this.getroutedetailparam=obj;
        //alert(JSON.stringify(obj));
        this.$.getroutedetailajax.generateRequest();
      },
      getroutedetailResponse:function(e1)
          { 
            //alert('i m back');
          var routedetails=e1.detail.response.returnval;
          //alert(JSON.stringify(routedetails));
          document.querySelector('mappointtoroute-card').itemarr=routedetails;
      },

      insertpoint:function(route,pt,tripp,pickuptime,droptime)
      {
        point=pt;
        trip=tripp;
        pick=pickuptime;
        drop=droptime;
        this.routeidurl="http://localhost:8081/routeid";
        var obj={"routename":""};
        obj.routename=route;
        this.routeidparam=obj;
        this.$.routeidajax.generateRequest();
      },
      routeidResponse:function(e)
      {
        routeidd=e.detail.response.returnval[0].id;
         this.sequenceurl="http://localhost:8081/sequence";
         this.$.sequenceajax.generateRequest();

      },
      sequenceResponse:function(e)
      {
        var seq=(e.detail.response.returnval[0].count)+1;
        //alert(seq);
        var obj={"id":"","routes":"","points":"","trip":"","pick":"","drop":""};
        obj.id="p"+seq;
        obj.routes=routeidd;
        obj.points=point;
        obj.trip=trip;
        obj.pick=pick;
        obj.drop=drop;
        this.insertpointparam=obj;
        this.insertpointurl="http://localhost:8081/insertpoint";
        this.$.insertpointajax.generateRequest();

      },
         getzone:function()

      {
        this.getzoneurl="http://localhost:8081/getzone";
        this.$.getzoneajax.generateRequest();
      },
      getzoneResponse:function(e1)
          {
            var zoneitem=e1.detail.response.returnval;
            document.querySelector('zonetostudent-card').itemarr=zoneitem;
      },
      getfee:function(zone)
      {
        this.getfeeurl = "http://localhost:8081/getfee";
        var obj={"zone":""}
        obj.zone=zone;
        this.getfeeparam=obj;
        this.$.getfeeajax.generateRequest();
      },
      getfeeResponse:function(e){
         totalfee=e.detail.response.returnval[0].fees;
      },
      calc:function(values){
      if(values=='foryear'){
        var yearlyfee=totalfee;
       
        document.querySelector('zonetostudent-card').fee=yearlyfee;
      
   }
      },
      gettermdate:function(id){
         this.gettermdateurl="http://localhost:8081/gettermdate";
         var obj={"idb":""}
         obj.idb=id;
         this.gettermdateparam=obj;
        this.$.gettermdateajax.generateRequest();
      },
         gettermdateResponse:function(e1)
          {
            var fromdate1=e1.detail.response.returnval[0].from_date;
            var todate1=e1.detail.response.returnval[0].to_date;
            document.querySelector('zonetostudent-card').zfromdate=fromdate1;
            document.querySelector('zonetostudent-card').ztodate=todate1;

      },
      setzone:function(studid,zone,fee,fromdatez,todatez)
      {
        this.setzoneurl = "http://localhost:8081/setzone";
        var obj={"studid":"","zone":"","fee":"","fromdate":"","todate":""};
        obj.studid=studid;
        obj.zone=zone;
        obj.fee=fee;
        obj.fromdate=fromdatez;
        obj.todate=todatez;
        this.setzoneparam=obj;
        alert(JSON.stringify(obj));
        this.$.setzoneajax.generateRequest();
      },
      setzoneResponse:function(e){
         var result=e.detail.response.returnval;
         //alert(result);
         if(result=="success")
         {
          alert('The data is inserted successfully');
         }
         else
         {
          alert('The data is not inserted');
         }
      },

      getstd:function()
      {
        this.getstdurl="http://localhost:8081/getstd";
        this.$.getstdajax.generateRequest();
      },
      getstdResponse:function(e1)
      {
            var a1=e1.detail.response.returnval;
            document.querySelector('zonetostudent-card').stdarr=a1;
      },
      getsec:function(std)
      {
        this.getsecurl="http://localhost:8081/getsec";
        var obj={"std":""};
        obj.std=std;
        this.getsecparam=obj;
        this.$.getsecajax.generateRequest();
      },
      getsecResponse:function(e1)
          {
            var secitem=e1.detail.response.returnval;
            document.querySelector('zonetostudent-card').secarr=secitem;
      },
       getname:function(std,sec)
      {
        this.getnameurl="http://localhost:8081/getname";
        var obj={"std":"","sec":""};
        obj.std=std;
        obj.sec=sec;
        this.getnameparam=obj;
        this.$.getnameajax.generateRequest();
      },
      getnameResponse:function(e1)
          {
            var iditem=e1.detail.response.returnval;
            document.querySelector('zonetostudent-card').studentidarr=iditem;
            document.querySelector('zonetostudent-card').autocompletearr(iditem);
            //alert(JSON.stringify(document.querySelector('zonetostudent-card').namearr));
      },

      getstudetail:function(studid)
      {
        this.getstudetailurl="http://localhost:8081/getstudetail";
        var obj={"studid":""};
        obj.studid=studid;
        this.getstudetailparam=obj;
        this.$.getstudetailajax.generateRequest();
      },
      getstudetailResponse:function(e1)
          {
            var profilename=e1.detail.response.returnval[0].student_name;
            var gradename=e1.detail.response.returnval[0].school_type;
            var dob=e1.detail.response.returnval[0].dob;
            var stdid=e1.detail.response.returnval[0].id;
            document.querySelector('zonetostudent-card').name=profilename;
            document.querySelector('zonetostudent-card').grade=gradename;
           document.querySelector('zonetostudent-card').date=dob;
 document.querySelector('zonetostudent-card').id=stdid;
            this.gradediscounturl="http://localhost:8081/gradediscount";
            var obj={"grade":""}
            obj.grade=gradename;
            this.gradediscountparam=obj;
            this.$.gradediscountajax.generateRequest();
      },
      gradediscountResponse:function(e){
        gradedis=e.detail.response.returnval[0].discount_percent;
        alert('discount percent is'+gradedis);

      },
      generatereport:function(studid){
        this.genereporturl="http://localhost:8081/report-card";
        var obj={"studid":""}
        obj.studid=studid;
        this.genereportparam=obj;
        this.$.genereportajax.generateRequest();
      },
      genereportResponse:function(e){
        //alert(JSON.stringify(e.detail.response.returnval));
        var reportresult=e.detail.response.returnval;
        document.querySelector('genestureport-card').reportarr=reportresult;
      },
     gettrip:function(routename)
      {
        routetrip=routename;
        //alert('name of route'+routetrip);
        //alert('Hi');
        this.gettripurl="http://localhost:8081/gettrip";
        var obj={"triproute":""};
        obj.triproute=routename;
        this.gettripparam=obj;
        //alert(JSON.stringify(obj));
        this.$.gettripajax.generateRequest();
      },
      gettripResponse:function(e1)
          { 
            //alert('i m back');
          var tripdetails=e1.detail.response.returnval;
          //alert(JSON.stringify(routedetails));
          document.querySelector('mappointtoroute-card').triparr=tripdetails;
      },
      //cancellation
      cancellation:function(studid){
        this.cancellationurl="http://localhost:8081/cancellation";
        var obj={"studid":""}
        obj.studid=studid;
        this.cancellationparam=obj;
        //alert(JSON.stringify(obj));
        this.$.cancellationajax.generateRequest();
      },
      cancellationResponse:function(e){
        //alert(JSON.stringify(e.detail.response.returnval));
        var reportresult=e.detail.response.returnval;
        document.querySelector('cancellation-card').cancellationarr=reportresult;
      }, 
      cancel:function(school_type, student_id){
        this.cancelurl="http://localhost:8081/cancel";
        var end_date = localStorage.getItem("localsess_curr_date",this.showdate);
        var obj={"school_type":"","student_id":"","end_date":""};
        obj.school_type=school_type;
        obj.student_id=student_id;
        obj.end_date=end_date;
        this.cancelparam=obj;
        this.$.cancelajax.generateRequest();
      },
      cancelResponse:function(e){
        var days_used = JSON.stringify(e.detail.response.returnval[0].Days_used);
        var total_days = JSON.stringify(e.detail.response.returnval[0].Total_days);
        var monthsused = days_used/30;
        var totalmonths = total_days/30;
        var months_used = Math.ceil(monthsused);
        var total_months = Math.ceil(totalmonths);
        var fees = JSON.stringify(e.detail.response.returnval[0].fees);
        var positive = total_months - months_used;
        var percent = (positive / total_months)*100;
        var refund_amount = (fees/100)*percent;
        document.querySelector('cancellation-item-card').months_used=months_used;
        document.querySelector('cancellation-item-card').total_months=total_months;
        document.querySelector('cancellation-item-card').refund_amount=refund_amount;
      },
      proceedcancellation:function(student_id, student_name, months_used, refund_amount){
        this.student_id=student_id;
        this.proceedcancelurl="http://localhost:8081/proceedcancel";
        var obj={"student_id":""}
        var obj={"student_name":""}
        var obj={"months_used":""}
        var obj={"refund_amount":""}
        obj.student_id=student_id;
        obj.student_name=student_name;
        obj.months_used=months_used;
        obj.refund_amount=refund_amount;
        this.proceedcancelparam=obj;
        this.$.proceedcancelajax.generateRequest();
      }, 
      proceedcancelResponse:function(e){
        var reportresult=e.detail.response.returnval;
        var obj={"student_id":""};
        obj.student_id=this.student_id;
        this.transportrequiredstatusparam=obj;
        //alert(JSON.stringify(obj));
        this.transportrequiredstatusurl="http://localhost:8081/transportrequiredstatus";
        this.$.transportrequiredstatusajax.generateRequest();
      },
      transportrequiredstatusResponse:function(e){

      }
    });
 })();
  </script>

</dom-module>

