<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="query-post">
  <template>
   <iron-ajax
    method="post"
    id="querypostid"
    url="{{queryposturl}}"
    params="{{querypostparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="querypostResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="sequenceid"
    url="{{sequenceurl}}"
    params="{{sequenceparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="sequenceResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="upseqid"
    url="{{upsequrl}}"
    params="{{upseqparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upseqResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="getmsgid"
    url="{{getmsgurl}}"
    params="{{getmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="getmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="queryreplyid"
    url="{{queryreplyurl}}"
    params="{{queryreplyparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="queryreplyResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="parentinboxid"
    url="{{parentinboxurl}}"
    params="{{parentinboxparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="parentinboxResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="managerinboxid"
    url="{{managerinboxurl}}"
    params="{{managerinboxparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="managerinboxResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="updatefwdid"
    url="{{updatefwdurl}}"
    params="{{updatefwdparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="updatefwdResponse"
    debounce-duration="300"
  ></iron-ajax>
<iron-ajax
    method="post"
    id="openreportid"
    url="{{openreporturl}}"
    params="{{openreportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="openreportResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="closereportid"
    url="{{closereporturl}}"
    params="{{closereportparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="closereportResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="upmsgstatid"
    url="{{upmsgstaturl}}"
    params="{{upmsgstatparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upmsgstatResponse"
    debounce-duration="300"
  ></iron-ajax>
   <iron-ajax
    method="post"
    id="unreadmsgid"
    url="{{unreadmsgurl}}"
    params="{{unreadmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="unreadmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="unopenmsgid"
    url="{{unopenmsgurl}}"
    params="{{unopenmsgparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="unopenmsgResponse"
    debounce-duration="300"
  ></iron-ajax>
  <iron-ajax
    method="post"
    id="upmsgstatprid"
    url="{{upmsgstatprurl}}"
    params="{{upmsgstatprparam}}"
    handle-as="json"
    content-type="application/json"
    on-response="upmsgstatprResponse"
    debounce-duration="300"
  ></iron-ajax>
  
    <style>
      :host {
        display: block;
      }
    </style>
    <div></div>
  </template>
  <script>
  (function() {
    'use strict';
    var stud_id;
    var sname;
    var semail;
    var scat;
    var scomplaint;
    var sub;
    var mobile;
    var stid;
    Polymer({
      is: 'query-post',
      ready:function(){

      },
      querypostFn:function(student_id,name,email,category,complaint,subject,mob){
        //alert('hai');
        stud_id=student_id;
        sname=name;
        semail=email;
        scat=category;
        scomplaint=complaint;
        sub=subject;
        mobile=mob;
       var obj={"school_id":""};
       obj.school_id=sessionStorage.getItem("schoolx");
       this.sequenceurl="http://localhost:8082/query-sequence";
       this.sequenceparam=obj;
       this.$.sequenceid.generateRequest();
            },

sequenceResponse:function(e){
  var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
  //alert(JSON.stringify(e.detail.response.returnval));
  var seq=e.detail.response.returnval[0].sequenceno;
  var obj={"student_id":"","date":"","time":"","name":"","email":"","category":"","complaint":"","queryid":"","flag":"","subject":"","mob":"","msq_status":""};
        obj.school_id=sessionStorage.getItem("schoolx");
        obj.query_id='REQ1600'+seq;
        obj.student_id=stud_id;
        obj.name=sname;
        obj.email=semail;
        obj.category=scat;
        obj.complaint=scomplaint;
        obj.date=datex;
        obj.time=thistime;
        obj.flag=1;
        obj.status="open";
        obj.subject=sub;
        obj.mob=mobile;
        obj.msq_status=1;
        this.queryposturl="http://localhost:8082/query-post1";
        this.querypostparam=obj;
       // alert(JSON.stringify(obj));
       this.$.querypostid.generateRequest()
       var obj1={"school_id":"","sequence":""}
       obj1.school_id=sessionStorage.getItem("schoolx");
       obj1.sequence=parseInt(seq)+1;
       this.upsequrl="http://localhost:8082/upquery-sequence";
       this.upseqparam=obj1;
       this.$.upseqid.generateRequest();

},
querypostResponse:function(e)
{
  var s=e.detail.response.returnval;
  if(s=='success'){
  alert("Feedback submited successfuly"); 
  document.querySelector('complaint-form').refresh(); 
  }
  else{
    alert("Feedback not submited");
  }
  

},
getmsg:function()
{

  this.getmsgurl="http://localhost:8082/getmsg";
  var obj={"schol":"","status":""}
  obj.schol=sessionStorage.getItem("schoolx");
  this.getmsgparam=obj;
  //alert(JSON.stringify(obj));
  this.$.getmsgid.generateRequest();

this.unopenmsgurl="http://localhost:8082/unopenmsg";
  var obj={"schol":"","status":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unopenmsgparam=obj;
  alert(JSON.stringify(obj));
  this.$.unopenmsgid.generateRequest();

},
unopenmsgResponse:function(e){
    var res=e.detail.response.returnval;
    alert('unread msg for admin   '+JSON.stringify(res));
},
getmsgResponse:function(e)
{
  var msgarr=e.detail.response.returnval;
  document.querySelector('parent-inbox').msgarr=msgarr;
  //alert(JSON.stringify(msgarr));
},
postreply:function(queryid,reply,statusx,date,time){
   var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
  this.queryposturl="http://localhost:8082/querypost";
  var obj={"id":"","msg":"","schol":"","msg_status":"","replydate":"","replytime":"","status":"","flag":"","date":"","time":""}
  obj.id=queryid;
  obj.msg=reply;
  obj.replydate=datex;
  obj.replytime=thistime;
  obj.status=statusx;
  obj.date=date;
  obj.time=time;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.msg_status=1;
  this.querypostparam=obj;
  this.$.querypostid.generateRequest();
},

parentinbox:function(){
       // alert('1');
this.parentinboxurl="http://localhost:8082/parentinbox";
var obj={"id":"","schol":"","status":""}
obj.id=sessionStorage.getItem("studid");
obj.schol=sessionStorage.getItem("schoolx");
obj.status="closed";
alert(JSON.stringify(obj));
this.parentinboxparam=obj;
this.$.parentinboxid.generateRequest();


this.unreadmsgurl="http://localhost:8082/unreadmsg";
  var obj={"sid":"","schol":"","status":""}
  obj.sid=sessionStorage.getItem("studid");
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unreadmsgparam=obj;
  this.$.unreadmsgid.generateRequest();
},
parentinboxResponse:function(e){
  //alert('2');
  var resarr=e.detail.response.returnval;
  //alert(JSON.stringify(resarr));
  document.querySelector('parentinbox-itemcard').msgarr=resarr;
alert('hi'+JSON.stringify(resarr));
},
postquery:function(queryid,reply,status,flag,id,par,mail,category,mobile){
    var d1=new Date();
  var datex=d1.getDate()+'/'+(d1.getMonth()+1)+'/'+d1.getFullYear();
  var h =  d1.getHours(), m = d1.getMinutes();
    var thistime = (h > 12) ? (h-12 + ':' + m +' PM') : (h + ':' + m +' AM');
    var obj={"schoolid":"","queryid":"","name":"","complaint":"","date":"","time":"","status":"","flag":"","category":"","mob":"","msq_status":""}
    obj.school_id=sessionStorage.getItem("schoolx");
    obj.query_id=queryid;
    obj.complaint=reply;
    obj.date=datex;
    obj.time=thistime;
    obj.status=status;
    obj.flag=flag;
    obj.student_id=id;
        obj.name=par;
        obj.email=mail;
        obj.category=category;
        obj.mob=mobile;
        obj.msq_status=1;
    this.queryposturl="http://localhost:8082/query-post1";
        this.querypostparam=obj;
       // alert(JSON.stringify(obj));
       this.$.querypostid.generateRequest()

},
managerinbox:function(){
        //alert('1');
this.managerinboxurl="http://localhost:8082/managerinbox";
var obj={"schol":"","frwd":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.frwd="manager";
this.managerinboxparam=obj;
this.$.managerinboxid.generateRequest();
},
managerinboxResponse:function(e){
  //alert('2');
   var msgarr=e.detail.response.returnval;
  document.querySelector('parent-inbox').msgarr=msgarr;
  //alert(JSON.stringify(msgarr));
},
updatefrwd:function(querid,date,time){
  this.updatefwdurl="http://localhost:8082/updatefwd";
  var obj={"id":"","date":"","time":"","frwd":"","schol":""}
  obj.id=querid;
  obj.date=date;
  obj.time=time;
  obj.frwd="manager";
  obj.schol=sessionStorage.getItem("schoolx");
  this.updatefwdparam=obj;
  this.$.updatefwdid.generateRequest();

},
updatefwdResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success'){
    alert('Forwarded to Manager');
  }
  else{
   alert('Not Forwarded'); 
  }
},
getreport:function(){
this.openreporturl="http://localhost:8082/openreport";
var obj={"schol":"","status":""}
obj.schol=sessionStorage.getItem("schoolx");
obj.status="open";
obj.flag=1;
this.openreportparam=obj;
this.$.openreportid.generateRequest();

this.closereporturl="http://localhost:8082/closereport";
var obj1={"schol":"","status":""}
obj1.schol=sessionStorage.getItem("schoolx");
obj1.status="closed";
obj1.flag=1;
this.closereportparam=obj1;
this.$.closereportid.generateRequest();

},
openreportResponse:function(e){
  if(e.detail.response.returnval!=0){
  var tex=e.detail.response.returnval;
//alert(JSON.stringify(tex));
var len=tex.length;

document.querySelector('reportstatus-card').pendingarr=tex;
document.querySelector('reportstatus-card').noofpend=len;
}
},
closereportResponse:function(e){
  if(e.detail.response.returnval!=0){
  var tex=e.detail.response.returnval; 
  //alert(JSON.stringify(tex)); 
  var len=tex.length;
  document.querySelector('reportstatus-card').closedarr=tex;
   document.querySelector('reportstatus-card').noofclose=len;
}
},
upmsgstat:function(id,sid,time,date){
this.upmsgstaturl="http://localhost:8082/upmsgstat";
var obj={"sid":"","time":"","date":"","msg_status":"","schol":""}
obj.sid=id;
obj.time=time;
obj.date=date;
obj.schol=sessionStorage.getItem("schoolx");
obj.msg_status=2;

this.upmsgstatparam=obj;
alert(JSON.stringify(obj));
this.$.upmsgstatid.generateRequest();
},
upmsgstatResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success')
  {
    alert('messaged is opened now');
  }

  this.unopenmsgurl="http://localhost:8082/unopenmsg";
  var obj={"schol":"","status":""}
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unopenmsgparam=obj;
  alert(JSON.stringify(obj));
  this.$.unopenmsgid.generateRequest();

},
unopenmsgResponse:function(e)
{
  var resno=e.detail.response.returnval;
  alert('total unread msg for this id is'+JSON.stringify(resno));
},
upmsgstatpr:function(id,sid,time,date){
    stid=sid;
this.upmsgstatprurl="http://localhost:8082/upmsgstatpr";
var obj={"sid":"","time":"","date":"","msgstatus":"","schol":""}
obj.sid=id;
obj.time=time;
obj.date=date;
obj.msgstatus=2;
obj.schol=sessionStorage.getItem("schoolx");


this.upmsgstatprparam=obj;
alert('parent reply  '+JSON.stringify(obj));
this.$.upmsgstatprid.generateRequest();

},
upmsgstatprResponse:function(e){
  var res=e.detail.response.returnval;
  if(res=='success')
  {
    alert('parent messaged is opened now');
  }

  this.unreadmsgurl="http://localhost:8082/unreadmsg";
  var obj={"sid":"","schol":"","status":""}
  obj.sid=stid;
  obj.schol=sessionStorage.getItem("schoolx");
  obj.status=1;
  this.unreadmsgparam=obj;
  alert(JSON.stringify(obj));
  this.$.unreadmsgid.generateRequest();
},
unreadmsgResponse:function(e){
  var resno=e.detail.response.returnval;
  alert('total parent unread msg for this id is'+JSON.stringify(resno));
}
     

    });
  })();
  </script>
</dom-module>
