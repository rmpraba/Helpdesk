<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="login-service">
  <template>
    <iron-ajax
        method="post"
        id="mobileajax"
        url="{{mobileurl}}"
        params="{{mobileparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="mobileResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <iron-ajax
        method="post"
        id="adminloginajax"
        url="{{adminloginurl}}"
        params="{{adminloginparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="adminloginResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'login-service',

    mobile:function(mobile){
      this.mobileurl="http://localhost:8082/mobile";
      var obj={"mobile":""};
      obj.mobile=mobile;
      this.mobileparam=obj;
      this.$.mobileajax.generateRequest();
    },
    mobileResponse:function(e)
    {
      if(e.detail.response.returnval.length>0)
      {
        var school=e.detail.response.returnval[0].school_id;
        sessionStorage.setItem("schoolx",school);
      var parent=e.detail.response.returnval;
      document.querySelector('login-form').parent=parent;
      }
    else
    {
      alert("Invalid Mobile Number");
    }
    },
    adminlogin:function(username,password){
      this.adminloginurl="http://localhost:8082/adminlogin";
      var obj={"user":"","pass":""}
      obj.user=username;
      obj.pass=password;
      this.adminloginparam=obj;
      this.$.adminloginajax.generateRequest();
    },
    adminloginResponse:function(e){
      var res=e.detail.response.returnval;
      if(res!=0){
      var id=e.detail.response.returnval[0].id;
      var schoolx=e.detail.response.returnval[0].school_id;
      document.querySelector('transport-app').setPage("iconpage");
      }
      else if(res=='invalid'){
          alert('Wrong Username and Password');
      }
    }

    });
  })();
  </script>
</dom-module>
